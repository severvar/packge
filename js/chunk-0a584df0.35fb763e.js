(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a584df0","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437"],{"267bb":function(t,e,n){"use strict";n.r(e),n.d(e,"FinancialModalMixin",(function(){return s}));n("e2e0");var a=n("4ec3"),r=n("0fea"),o=n("ca00");function i(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=l(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){c=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw o}}}}function l(t,e){if(t){if("string"===typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var s={data:function(){return{action:"",supList:[],cusList:[],retailList:[],personList:[],accountList:[],spans:{labelCol1:{span:2},wrapperCol1:{span:22},labelCol1_5:{span:3},wrapperCol1_5:{span:21},labelCol2:{span:4},wrapperCol2:{span:20},labelCol3:{span:6},wrapperCol3:{span:18},labelCol6:{span:12},wrapperCol6:{span:12}}}},created:function(){this.initSupplier(),this.initCustomer(),this.initRetail(),this.initPerson()},computed:{readOnly:function(){return"add"!==this.action&&"edit"!==this.action}},methods:{addInit:function(t){var e=this;Object(r["c"])("/sequence/buildNumber").then((function(n){n&&200===n.code&&e.form.setFieldsValue({billNo:t+n.data.defaultNumber})})),this.$nextTick((function(){e.form.setFieldsValue({billTime:Object(o["g"])(),totalPrice:0,discountMoney:0,changeAmount:0})})),this.$nextTick((function(){Object(a["db"])({}).then((function(t){if(t&&200===t.code){var n,a=i(t.data.accountList);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.isDefault&&e.form.setFieldsValue({accountId:r.id})}}catch(o){a.e(o)}finally{a.f()}}}))}))},initSupplier:function(){var t=this;Object(a["Y"])({}).then((function(e){e&&(t.supList=e)}))},initCustomer:function(){var t=this;Object(a["W"])({}).then((function(e){e&&(t.cusList=e)}))},initRetail:function(){var t=this;Object(a["X"])({}).then((function(e){e&&(t.retailList=e)}))},initPerson:function(){var t=this;Object(a["jb"])({type:"财务员"}).then((function(e){e&&200===e.code&&(t.personList=e.data.personList)}))},initInOutItem:function(t){var e=this;Object(a["ab"])({type:t}).then((function(t){if(t)for(var n=0;n<t.length;n++){var a={};a.value=t[n].id+"",a.text=t[n].name,a.title=t[n].name;var r,o=i(e.accountTable.columns);try{for(o.s();!(r=o.n()).done;){var l=r.value;"inOutItemId"==l.key&&l.options.push(a)}}catch(c){o.e(c)}finally{o.f()}}}))},initAccount:function(){var t=this;Object(a["db"])({}).then((function(e){e&&200===e.code&&(t.accountList=e.data.accountList)}))},initDetailAccount:function(){var t=this;Object(a["db"])({}).then((function(e){if(e&&200===e.code)for(var n=e.data.accountList,a=0;a<n.length;a++){var r={};r.value=n[a].id+"",r.text=n[a].name,r.title=n[a].name;var o,l=i(t.accountTable.columns);try{for(l.s();!(o=l.n()).done;){var c=o.value;"accountId"==c.key&&c.options.push(r)}}catch(s){l.e(s)}finally{l.f()}}}))},onValueChange:function(t){var e=this,n=(t.type,t.row,t.column),a=(t.value,t.target);switch(n.key){case"eachAmount":a.recalcAllStatisticsColumns(),e.autoChangeAmount(a);break}},autoChangeAmount:function(t){var e=this,n=t.statisticsColumns.eachAmount-0,a=this.form.getFieldValue("discountMoney")-0;a||(a=0);var r=(n-a).toFixed(2);this.$nextTick((function(){e.form.setFieldsValue({totalPrice:n,changeAmount:r})}))},onKeyUpDiscountMoney:function(t){var e=this,n=t.target.value-0,a=this.form.getFieldValue("totalPrice")-0,r=(a-n).toFixed(2);this.$nextTick((function(){e.form.setFieldsValue({changeAmount:r})}))},debtBillListOk:function(t){t&&t.length>0&&this.requestSubTableDataEx(t,this.accountTable)},requestSubTableDataEx:function(t,e,n){var a=this;e.loading=!0;for(var r=[],o=0,i=0;i<t.length;i++){var l=t[i];l.billNumber=l.number,l.needDebt=(l.discountLastMoney+l.otherMoney-l.changeAmount).toFixed(2),l.eachAmount=(l.discountLastMoney+l.otherMoney-l.changeAmount-l.finishDebt).toFixed(2),0!=l.eachAmount&&(o+=l.eachAmount-0,r.push(l))}e.dataSource=r,this.$nextTick((function(){a.form.setFieldsValue({totalPrice:o,changeAmount:o})})),"function"===typeof n&&n(res),e.loading=!1}}}},"761b":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-modal",{staticStyle:{top:"5%",height:"100%","overflow-y":"hidden"},attrs:{title:t.title,width:t.width,visible:t.visible,confirmLoading:t.confirmLoading,maskClosable:!1,keyboard:!1,forceRender:!0,switchFullscreen:"",wrapClassName:"ant-modal-cust-warp"},on:{ok:t.handleOk,cancel:t.handleCancel}},[n("a-spin",{attrs:{spinning:t.confirmLoading}},[n("a-form",{attrs:{form:t.form}},[n("a-row",{staticClass:"form-row",attrs:{gutter:24}},[n("a-col",{attrs:{lg:6,md:12,sm:24}},[n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"经手人"}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["handsPersonId",t.validatorRules.handsPersonId],expression:"[ 'handsPersonId', validatorRules.handsPersonId ]"}],attrs:{placeholder:"选择经手人",dropdownMatchSelectWidth:!1,showSearch:"",optionFilterProp:"children"}},t._l(t.personList,(function(e,a){return n("a-select-option",{key:a,attrs:{value:e.id}},[t._v("\n                "+t._s(e.name)+"\n              ")])})),1)],1)],1),n("a-col",{attrs:{lg:6,md:12,sm:24}},[n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"单据日期"}},[n("j-date",{directives:[{name:"decorator",rawName:"v-decorator",value:["billTime",t.validatorRules.billTime],expression:"['billTime', validatorRules.billTime]"}],attrs:{"show-time":!0}})],1)],1),n("a-col",{attrs:{lg:6,md:12,sm:24}},[n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"单据编号"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["billNo"],expression:"[ 'billNo' ]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入单据编号",readOnly:!0}})],1)],1),n("a-col",{attrs:{lg:6,md:12,sm:24}})],1),n("j-editable-table",{ref:t.refKeys[0],attrs:{loading:t.accountTable.loading,columns:t.accountTable.columns,dataSource:t.accountTable.dataSource,maxHeight:300,rowNumber:!1,rowSelection:!0,actionButton:!0},on:{valueChange:t.onValueChange}}),n("a-row",{staticClass:"form-row",attrs:{gutter:24}},[n("a-col",{attrs:{lg:24,md:24,sm:24}},[n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:{xs:{span:24},sm:{span:24}},label:""}},[n("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark"],expression:"[ 'remark' ]"}],staticStyle:{"margin-top":"8px"},attrs:{rows:2,placeholder:"请输入备注"}})],1)],1)],1),n("a-row",{staticClass:"form-row",attrs:{gutter:24}},[n("a-col",{attrs:{lg:6,md:12,sm:24}},[n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"付款账户"}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["accountId",t.validatorRules.accountId],expression:"[ 'accountId', validatorRules.accountId ]"}],attrs:{placeholder:"选择付款账户",dropdownMatchSelectWidth:!1}},t._l(t.accountList,(function(e,a){return n("a-select-option",{key:a,attrs:{value:e.id}},[t._v("\n                "+t._s(e.name)+"\n              ")])})),1)],1)],1),n("a-col",{attrs:{lg:6,md:12,sm:24}},[n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"实付金额"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["changeAmount",t.validatorRules.changeAmount],expression:"[ 'changeAmount', validatorRules.changeAmount ]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入实付金额"}})],1)],1),n("a-col",{attrs:{lg:6,md:12,sm:24}}),n("a-col",{attrs:{lg:6,md:12,sm:24}})],1),n("a-row",{staticClass:"form-row",attrs:{gutter:24}},[n("a-col",{attrs:{lg:6,md:12,sm:24}},[n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"附件"}},[n("j-upload",{attrs:{bizPath:"financial"},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1)],1)],1)],1)],1)],1)},r=[],o=n("88bc"),i=n.n(o),l=n("e2e0"),c=n("d0ed"),s=n("267bb"),u=n("cf74"),d=n("2dab");function f(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=h(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){l=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function h(t,e){if(t){if("string"===typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var p={name:"GiroModal",mixins:[c["a"],s["FinancialModalMixin"]],components:{JUpload:u["default"],JDate:d["default"]},data:function(){return{title:"操作",width:"1200px",moreStatus:!1,addDefaultRowNum:1,visible:!1,model:{},fileList:[],labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}},refKeys:["accountDataTable"],activeKey:"accountDataTable",accountTable:{loading:!1,dataSource:[],columns:[{title:"账户名称",key:"accountId",width:"20%",type:l["a"].select,placeholder:"请选择${title}",options:[],validateRules:[{required:!0,message:"${title}不能为空"}]},{title:"金额",key:"eachAmount",width:"10%",type:l["a"].inputNumber,statistics:!0,placeholder:"请选择${title}",validateRules:[{required:!0,message:"${title}不能为空"}]},{title:"备注",key:"remark",width:"30%",type:l["a"].input,placeholder:"请选择${title}"}]},confirmLoading:!1,validatorRules:{handsPersonId:{rules:[{required:!0,message:"请选择经手人!"}]},billTime:{rules:[{required:!0,message:"请选择单据日期!"}]},accountId:{rules:[{required:!0,message:"请选择付款账户!"}]},changeAmount:{rules:[{required:!0,message:"请输入实付金额!"}]}},url:{add:"/accountHead/addAccountHeadAndDetail",edit:"/accountHead/updateAccountHeadAndDetail",detailList:"/accountItem/getDetailList"}}},created:function(){this.initAccount(),this.initDetailAccount()},methods:{editAfter:function(){var t=this;if("add"===this.action)this.addInit("ZZ"),this.fileList=[];else{this.model.billTime=this.model.billTimeStr,this.$nextTick((function(){t.form.setFieldsValue(i()(t.model,"organId","handsPersonId","billTime","billNo","remark","accountId","changeAmount"))})),this.fileList=this.model.fileName;var e={headerId:this.model.id},n=(this.readOnly,this.url.detailList);this.requestSubTableData(n,e,this.accountTable)}},classifyIntoFormData:function(t){var e=0,n=Object.assign(this.model,t.formValue),a=t.tablesValue[0].values;n.type="转账";var r,o=f(a);try{for(o.s();!(r=o.n()).done;){var i=r.value;e+=i.eachAmount-0}}catch(l){o.e(l)}finally{o.f()}return n.totalPrice=0-e,n.changeAmount=0-n.changeAmount,this.fileList&&this.fileList.length>0&&(n.fileName=this.fileList),this.model.id&&(n.id=this.model.id),{info:JSON.stringify(n),rows:JSON.stringify(a)}},autoChangeAmount:function(t){var e=this,n=t.statisticsColumns.eachAmount-0;this.$nextTick((function(){e.form.setFieldsValue({changeAmount:n})}))}}},b=p,v=n("2877"),y=Object(v["a"])(b,a,r,!1,null,"5cf3aa85",null);e["default"]=y.exports},"88bc":function(t,e,n){(function(e){var n=1/0,a=9007199254740991,r="[object Arguments]",o="[object Function]",i="[object GeneratorFunction]",l="[object Symbol]",c="object"==typeof e&&e&&e.Object===Object&&e,s="object"==typeof self&&self&&self.Object===Object&&self,u=c||s||Function("return this")();function d(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function f(t,e){var n=-1,a=t?t.length:0,r=Array(a);while(++n<a)r[n]=e(t[n],n,t);return r}function h(t,e){var n=-1,a=e.length,r=t.length;while(++n<a)t[r+n]=e[n];return t}var m=Object.prototype,p=m.hasOwnProperty,b=m.toString,v=u.Symbol,y=m.propertyIsEnumerable,g=v?v.isConcatSpreadable:void 0,w=Math.max;function A(t,e,n,a,r){var o=-1,i=t.length;n||(n=x),r||(r=[]);while(++o<i){var l=t[o];e>0&&n(l)?e>1?A(l,e-1,n,a,r):h(r,l):a||(r[r.length]=l)}return r}function C(t,e){return t=Object(t),k(t,e,(function(e,n){return n in t}))}function k(t,e,n){var a=-1,r=e.length,o={};while(++a<r){var i=e[a],l=t[i];n(l,i)&&(o[i]=l)}return o}function j(t,e){return e=w(void 0===e?t.length-1:e,0),function(){var n=arguments,a=-1,r=w(n.length-e,0),o=Array(r);while(++a<r)o[a]=n[e+a];a=-1;var i=Array(e+1);while(++a<e)i[a]=n[a];return i[e]=o,d(t,this,i)}}function x(t){return O(t)||L(t)||!!(g&&t&&t[g])}function T(t){if("string"==typeof t||M(t))return t;var e=t+"";return"0"==e&&1/t==-n?"-0":e}function L(t){return I(t)&&p.call(t,"callee")&&(!y.call(t,"callee")||b.call(t)==r)}var O=Array.isArray;function S(t){return null!=t&&N(t.length)&&!F(t)}function I(t){return $(t)&&S(t)}function F(t){var e=D(t)?b.call(t):"";return e==o||e==i}function N(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=a}function D(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function $(t){return!!t&&"object"==typeof t}function M(t){return"symbol"==typeof t||$(t)&&b.call(t)==l}var P=j((function(t,e){return null==t?{}:C(t,f(A(e,1),T))}));t.exports=P}).call(this,n("24aa"))},d0ed:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n("7550"),r=n("e2e0"),o=n("0fea"),i={components:{JEditableTable:a["default"]},data:function(){return{title:"操作",visible:!1,form:this.$form.createForm(this),confirmLoading:!1,model:{},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}},methods:{getAllTable:function(){var t=this;if(!(this.refKeys instanceof Array))throw this.throwNotArray("refKeys");var e=this.refKeys.map((function(e){return Object(r["c"])(t,e)}));return Promise.all(e)},eachAllTable:function(t){this.getAllTable().then((function(e){e.forEach((function(e,n){"function"===typeof t&&t(e,n)}))}))},add:function(){"function"===typeof this.addBefore&&this.addBefore();var t=this.addDefaultRowNum;"number"!==typeof t&&(t=1),this.eachAllTable((function(e){e.add(t)})),"function"===typeof this.addAfter&&this.addAfter(this.model),this.edit({})},edit:function(t){"function"===typeof this.editBefore&&this.editBefore(t),this.visible=!0,this.activeKey=this.refKeys[0],this.form.resetFields(),this.model=Object.assign({},t),"function"===typeof this.editAfter&&this.editAfter(this.model)},close:function(){this.visible=!1,this.eachAllTable((function(t){t.initialize()})),this.$emit("close")},requestSubTableData:function(t,e,n,a){n.loading=!0,Object(o["c"])(t,e).then((function(t){t&&200===t.code&&(n.dataSource=t.data.rows,"function"===typeof a&&a(t))})).finally((function(){n.loading=!1}))},request:function(t){var e=this,n=this.url.add,a="post";this.model.id&&(n=this.url.edit,a="put"),this.confirmLoading=!0,Object(o["e"])(n,t,a).then((function(t){200===t.code?(e.$emit("ok"),e.confirmLoading=!1,e.close()):(e.$message.warning(t.data.message),e.confirmLoading=!1)})).finally((function(){}))},handleChangeTabs:function(t){Object(r["c"])(this,t).then((function(t){t.resetScrollTop()}))},handleCancel:function(){this.close()},handleOk:function(){var t=this;this.getAllTable().then((function(e){return Object(r["d"])(t.form,e)})).then((function(e){if("function"!==typeof t.classifyIntoFormData)throw t.throwNotFunction("classifyIntoFormData");var n=t.classifyIntoFormData(e);return t.request(n)})).catch((function(e){e.error===r["b"]&&(t.activeKey=null==e.index?t.activeKey:t.refKeys[e.index])}))},throwNotFunction:function(t){return"".concat(t," 未定义或不是一个函数")},throwNotArray:function(t){return"".concat(t," 未定义或不是一个数组")}}}}}]);